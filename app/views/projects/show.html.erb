<div class="container py-5">

  <section class="mb-5 border-bottom pb-3">
    <h1 class="display-4 mb-1"><%= @project.name %></h1>
    <p class="text-muted">Conversation</p>
  </section>

  <section class="mb-4">
    <h2 class="h5 mb-3">Leave a Comment</h2>
    <%= form_with(model: [@project, Comment.new], local: true) do |form| %>
      <div class="mb-3">
        <%= form.label :body, "Leave a Comment", class: "form-label" %>
        <%= form.text_area :body, class: "form-control", rows: 3 %>
      </div>
      <%= form.submit "Post Comment", class: "btn btn-primary" %>
    <% end %>
  </section>

  <section class="mb-5">
    <h2 class="h5 mb-3">Change Project Status</h2>
    <%= form_with model: [@project, StatusChange.new], local: true do |form| %>
      <div class="mb-3">
        <%= form.label :status, "Change Status", class: "form-label" %>
        <%= form.select :status, StatusChange.statuses.keys.map { |s| [s.humanize, s] }, {}, class: "form-select" %>
      </div>
      <%= form.submit "Update Status", class: "btn btn-success" %>
    <% end %>
  </section>

  <section>
    <h2 class="h4 mb-4">Conversation History</h2>
    <ul class="list-unstyled">
      <% @conversation_feed.each do |event| %>
        <% if event.is_a?(Comment) %>
          <li class="mb-3 p-3 border rounded bg-light shadow-sm">
            <strong class="text-primary"><%= event.user.name %>:</strong>
            <p class="mb-1"><%= event.body %></p>
            <small class="text-muted"><%= event.created_at.strftime("%B %d, %Y %H:%M") %></small>
          </li>
        <% elsif event.is_a?(StatusChange) %>
          <li class="mb-3 p-3 border rounded bg-white shadow-sm">
            <strong class="text-success"><%= event.user.name %></strong>
            changed the status to
            <span class="fw-bold"><%= event.status.humanize %></span>
            <br>
            <small class="text-muted"><%= event.created_at.strftime("%B %d, %Y %H:%M") %></small>
          </li>
        <% end %>
      <% end %>
    </ul>
  </section>

</div>